!function(){"use strict";var e={n:function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,{a:r}),r},d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:function(){return k}}),require("core-js/modules/es.object.get-prototype-of.js"),require("core-js/modules/es.reflect.construct.js"),require("core-js/modules/es.symbol.js"),require("core-js/modules/es.object.get-own-property-descriptor.js"),require("core-js/modules/es.object.get-own-property-descriptors.js"),require("core-js/modules/es.symbol.description.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.symbol.iterator.js"),require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.array.last-index-of.js"),require("core-js/modules/es.array.slice.js"),require("core-js/modules/es.regexp.constructor.js"),require("core-js/modules/es.regexp.exec.js"),require("core-js/modules/es.regexp.to-string.js"),require("core-js/modules/es.array.sort.js"),require("core-js/modules/web.dom-collections.for-each.js"),require("core-js/modules/es.string.match.js"),require("core-js/modules/es.array.filter.js"),require("core-js/modules/es.array.map.js"),require("core-js/modules/es.string.split.js"),require("core-js/modules/esnext.string.replace-all.js"),require("core-js/modules/es.string.trim.js"),require("core-js/modules/es.object.keys.js"),require("core-js/modules/es.array.index-of.js"),require("core-js/modules/es.array.concat.js"),require("core-js/modules/es.array.includes.js"),require("core-js/modules/es.string.includes.js"),require("core-js/modules/es.object.assign.js");var r=require("react"),n=e.n(r),o=require("prop-types"),i=e.n(o),s=require("textarea-caret"),a=e.n(s),l=require("get-input-selection"),c=e.n(l),u=require("lodash.debounce"),h=e.n(u),f=["Component","defaultValue","disabled","onBlur","value"];function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function g(e){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){y(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t){return!t||"object"!==g(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w={Component:i().oneOfType([i().string,i().elementType]),defaultValue:i().string,disabled:i().bool,maxOptions:i().number,onBlur:i().func,onChange:i().func,onKeyDown:i().func,onRequestOptions:i().func,onSelect:i().func,changeOnSelect:i().func,options:i().oneOfType([i().object,i().arrayOf(i().string)]),regex:i().string,matchAny:i().bool,minChars:i().number,disableMinChars:i().arrayOf(i().string),requestOnlyIfNoOptions:i().bool,spaceRemovers:i().arrayOf(i().string),spacer:i().string,trigger:i().oneOfType([i().string,i().arrayOf(i().string)]),disableSpacerOn:i().arrayOf(i().string),value:i().string,offsetX:i().number,offsetY:i().number,containerMaxHeight:i().number,itemHeight:i().number,passThroughEnter:i().bool,styles:i().shape({container:i().oneOfType([i().string,i().object]),list:i().oneOfType([i().string,i().object])}),hierarchicalStringResolver:i().func,watchTriggers:i().arrayOf(i().string),loading:i().bool},q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(d,e);var t,o,i,s,u=(i=d,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(i);if(s){var r=S(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return j(this,e)});function d(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),(t=u.call(this,e)).isTrigger=t.isTrigger.bind(O(t)),t.arrayTriggerMatch=t.arrayTriggerMatch.bind(O(t)),t.getMatch=t.getMatch.bind(O(t)),t.handleChange=t.handleChange.bind(O(t)),t.handleKeyDown=t.handleKeyDown.bind(O(t)),t.handleResize=t.handleResize.bind(O(t)),t.handleSelection=t.handleSelection.bind(O(t)),t.updateCaretPosition=t.updateCaretPosition.bind(O(t)),t.updateHelper=t.updateHelper.bind(O(t)),t.resetHelper=t.resetHelper.bind(O(t)),t.renderAutocompleteList=t.renderAutocompleteList.bind(O(t)),t.handleMoveSelection=t.handleMoveSelection.bind(O(t)),t.handleTab=t.handleTab.bind(O(t)),t.debouncedOnRequestOptions=h()(e.onRequestOptions,500).bind(O(t)),t.state={helperVisible:!1,left:0,trigger:null,matchLength:0,matchStart:0,options:[],selection:0,top:0,value:null},t.recentValue=e.defaultValue,t.enableSpaceRemovers=!1,t.refInput=(0,r.createRef)(),t.refSuggestion=(0,r.createRef)(),t}return t=d,(o=[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e){var t=this.props.options,r=this.state.caret;JSON.stringify(t)!==JSON.stringify(e.options)&&this.updateHelper(this.recentValue,r,t)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"getMatch",value:function(e,t,r){var n=this,o=this.props,i=o.trigger,s=o.minChars,a=o.matchAny,l=o.regex,c=new RegExp(l),u=i;Array.isArray(u)||(u=new Array(i)),u.sort();var h=r;Array.isArray(r)&&u.forEach((function(e){h[e]=r}));for(var f=this.arrayTriggerMatch(u,c),p=null,g=0;g<f.length;g++)for(var d=f[g],y=d.triggerStr,m=d.triggerMatch,v=d.triggerLength,j=t-1;j>=0;--j){var O=e.substring(j,t).match(c),S=-1;if(v>0){var w=m?j:j-v+1;if(w<0)break;if(this.isTrigger(y,e,w)&&(S=w+v),!O&&S<0)break}else{var q=e.lastIndexOf(" ",t);if(t-(S=q>=0?q+1:0)<=s-1)break}if(S>=0){var k=function(){var r=h[y];if(null==r)return"continue";var o=e.substring(S,t),i=[];if(Array.isArray(r))i=r.filter((function(e){var t=e.toLowerCase().indexOf(o.toLowerCase());return-1!==t&&(a||0===t)}));else{for(var s=(0,n.props.hierarchicalStringResolver)(e,S).split(y).map((function(e){return e.trim().replaceAll(/('|")/g,"")})).filter((function(e){return e.length})),l=1,c=r[s[0]];l<s.length;){if(!c[s[l]]){c={};break}c=c[s[l]],l+=1}i=Object.keys(c||[]).filter((function(e){var t=e.toLowerCase().indexOf(o.toLowerCase());return-1!==t&&(a||0===t)}))}var u=y,f=o.length;return p=null===p?{trigger:u,matchStart:S,matchLength:f,options:i}:b(b({},p),{},{trigger:u,matchStart:S,matchLength:f,options:i}),0===v?"break":void 0}();if("continue"===k)continue;if("break"===k)break}}return p}},{key:"arrayTriggerMatch",value:function(e,t){return e.map((function(e){return{triggerStr:e,triggerMatch:e.match(t),triggerLength:e.length}}))}},{key:"isTrigger",value:function(e,t,r){return!e||!e.length||t.substr(r,e.length)===e}},{key:"handleChange",value:function(e){var t=this.props,r=t.onChange,n=t.options,o=t.spaceRemovers,i=t.spacer,s=t.value,a=this.recentValue,l=e.target.value,u=c()(e.target).end;if(l.length||this.setState({helperVisible:!1}),this.recentValue=l,this.setState({caret:u,value:e.target.value}),!l.length||!u)return r(e.target.value);if(this.enableSpaceRemovers&&o.length&&l.length>2&&i.length){for(var h=0;h<Math.max(a.length,l.length);++h)if(a[h]!==l[h]){if(h>=2&&l[h-1]===i&&-1===o.indexOf(l[h-2])&&-1!==o.indexOf(l[h])&&this.getMatch(l.substring(0,h-2),u-3,n)){var f="".concat(l.slice(0,h-1)).concat(l.slice(h,h+1)).concat(l.slice(h-1,h)).concat(l.slice(h+1));return this.updateCaretPosition(h+1),this.refInput.current.value=f,s||this.setState({value:f}),r(f)}break}this.enableSpaceRemovers=!1}return this.updateHelper(l,u,n),s||this.setState({value:e.target.value}),r(e.target.value)}},{key:"handleKeyDown",value:function(e){var t=this.state,r=t.helperVisible,n=t.options,o=t.selection,i=this.props,s=i.onKeyDown,a=i.passThroughEnter;if(r)switch(e.keyCode){case 27:e.preventDefault(),e.stopPropagation(),this.resetHelper();break;case 38:e.preventDefault();var l=(n.length+o-1)%n.length;this.setState({selection:l}),this.handleMoveSelection(l);break;case 40:var c=(o+1)%n.length;e.preventDefault(),this.setState({selection:c}),this.handleMoveSelection(c);break;case 14:case 13:a||e.preventDefault(),this.handleSelection(o);break;case 9:e.preventDefault(),this.handleSelection(o);break;default:s(e)}else 9===e.keyCode?(this.handleTab(),e.preventDefault()):s(e)}},{key:"handleResize",value:function(){this.setState({helperVisible:!1})}},{key:"handleTab",value:function(){var e=this.state.caret,t=this.recentValue,r=t.substring(0,e),n=t.substring(e+1),o={target:this.refInput.current};o.target.value="".concat(r,"\t").concat(n),this.handleChange(o),this.updateCaretPosition(e+1)}},{key:"handleSelection",value:function(e){var t=this.props,r=t.spacer,n=t.onSelect,o=t.changeOnSelect,i=t.disableSpacerOn,s=this.state,a=s.matchStart,l=s.matchLength,c=s.options,u=s.trigger,h=c[e],f=this.recentValue,p=f.substring(0,a-u.length),g=f.substring(a+l),d={target:this.refInput.current},b=o(u,h),y=i.includes(u)?"":r;d.target.value="".concat(p).concat(b).concat(y).concat(g),this.handleChange(d),n(d.target.value,h,u),this.resetHelper();var m=p.length+b.length;i.includes(u)||(m+=1),this.updateCaretPosition(m),this.enableSpaceRemovers=!0}},{key:"handleMoveSelection",value:function(e){if(this.refSuggestion.current){var t=this.props,r=t.containerMaxHeight,n=t.itemHeight,o=this.refSuggestion.current;if(o.scrollHeight>o.clientHeight){var i=n*e-(r-n);o.scrollTo(0,i)}}}},{key:"updateCaretPosition",value:function(e){var t=this;this.setState({caret:e},(function(){return(0,l.setCaretPosition)(t.refInput.current,e)}))}},{key:"updateHelper",value:function(e,t,r){var n=this.refInput.current,o=this.getMatch(e,t,r);if(o){var i=a()(n,t),s=n.getBoundingClientRect(),l=i.top+n.offsetTop,c=Math.min(i.left+n.offsetLeft-10,n.offsetLeft+s.width-300),u=this.props,h=u.minChars,f=u.disableMinChars,p=u.requestOnlyIfNoOptions,g=u.loading,d=u.watchTriggers;p||!d.includes(o.trigger)||g||(this.setState({helperVisible:!0,top:l,left:c}),this.debouncedOnRequestOptions(e.substr(o.matchStart,o.matchLength)),this.resetHelper()),(o.matchLength>=h||f.includes(o.trigger))&&(o.options.length>1||1===o.options.length&&o.options[0].length!==o.matchLength)&&this.setState(b({helperVisible:!0,top:l,left:c},o))}else this.resetHelper()}},{key:"resetHelper",value:function(){this.setState({helperVisible:!1,selection:0})}},{key:"renderAutocompleteList",value:function(){var e=this,t=this.state,r=t.helperVisible,o=t.left,i=t.matchStart,s=t.matchLength,a=t.options,l=t.selection,c=t.top,u=t.value;if(!r)return null;var h=this.props,f=h.maxOptions,p=h.offsetX,d=h.offsetY,y=h.containerMaxHeight,m=h.itemHeight,v=h.styles,j=h.loading;if(0===a.length&&!j)return null;if(l>=a.length&&!j)return this.setState({selection:0}),null;var O=0===f?a.length:f,S="object"===g(v.container)?v.container:{},w="string"==typeof v.list?v.list:"",q="object"===g(v.list)?v.list:{},k=a.slice(0,O).map((function(t,r){var o=t.toLowerCase().indexOf(u.substr(i,s).toLowerCase());return n().createElement("li",{className:r===l?"".concat(w," active"):w,key:t,onClick:function(){e.handleSelection(r)},style:b(b({},q),{},{height:m})},t.slice(0,o),n().createElement("strong",{style:{color:"red"}},t.substr(o,s)),t.slice(o+s))})),C=n().createElement("li",{className:w,style:b(b({},q),{},{height:m})},"Loading...");return n().createElement("ul",{ref:this.refSuggestion,className:"string"==typeof v.container?v.container:"react-autocomplete-input",style:b(b({},S),{},{left:o+p,top:c+d,overflowY:"auto",overflowX:"hidden",maxHeight:y})},j?C:k)}},{key:"render",value:function(){var e=this.props,t=e.Component,r=e.defaultValue,o=e.disabled,i=e.onBlur,s=e.value,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,f),l=this.state.value,c=Object.assign({},a);Object.keys(w).forEach((function(e){delete c[e]}));var u="";return null!=s?u=s:l?u=l:r&&(u=r),n().createElement("span",null,n().createElement(t,p({disabled:o,onBlur:i,onChange:this.handleChange,onKeyDown:this.handleKeyDown,ref:this.refInput,value:u},c)),this.renderAutocompleteList())}}])&&m(t.prototype,o),d}(n().Component);q.propTypes=w,q.defaultProps={Component:"textarea",defaultValue:"",disabled:!1,maxOptions:0,onBlur:function(){},onChange:function(){},onKeyDown:function(){},onRequestOptions:function(){},onSelect:function(){},changeOnSelect:function(e,t){return e+t},options:[],regex:"^[A-Za-z0-9\\-_]+$",matchAny:!1,minChars:0,disableMinChars:[],requestOnlyIfNoOptions:!0,spaceRemovers:[",",".","!","?"],spacer:" ",disableSpacerOn:[],trigger:"@",offsetX:0,offsetY:0,containerMaxHeight:200,itemHeight:27,value:null,passThroughEnter:!1,styles:{},hierarchicalStringResolver:function(e,t){var r=e.lastIndexOf(" ",t),n=r>=0?r:0;return e.slice(n,t)},watchTriggers:[],loading:!1};var k=q;module.exports=t}();